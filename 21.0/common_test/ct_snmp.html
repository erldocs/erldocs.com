<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>ct_snmp (common_test) -  (Erlang Documentation)</title>
    <link href="../erldocs.css" type="text/css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs"/>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-44246018-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>

  <body>
    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off" placeholder="press TAB to search"/>
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        
  
  <h1>ct_snmp</h1>
  <h2 class="modsummary">Common Test user interface module for the SNMP application.</h2>

  <div class="description">

    <p><code>Common Test</code> user interface module for the <code>SNMP</code>
      application.</p>

    <p>The purpose of this module is to simplify SNMP configuration for the
      test case writer. Many test cases can use default values for common
      operations and then no SNMP configuration files need to be supplied.
      When it is necessary to change particular configuration parameters, a
      subset of the relevant SNMP configuration files can be passed to
      <code>ct_snmp</code> by <code>Common Test</code> configuration files. For more
      specialized configuration parameters, a simple SNMP configuration file
      can be placed in the test suite data directory. To simplify the test
      suite, <code>Common Test</code> keeps track of some of the SNMP manager
      information. This way the test suite does not have to handle as many
      input parameters as if it had to interface wthe OTP SNMP manager
      directly.</p>

    <p><em>Configurable SNMP Manager and Agent Parameters:</em></p>

    <p>Manager configuration:</p>

    <taglist>
      <dt><code>[{start_manager, boolean()}</code></dt>
        <item><p>Optional. Default is <code>true</code>.</p></item>
      <dt><code>{users, [{user_name(), [call_back_module(), user_data()]}]}</code></dt>
        <item><p>Optional.</p></item>
      <dt><code>{usm_users, [{usm_user_name(), [usm_config()]}]}</code></dt>
        <item><p>Optional. SNMPv3 only.</p></item>
      <dt><code>{managed_agents,[{agent_name(), [user_name(), agent_ip(), agent_port(), [agent_config()]]}]}</code></dt>
        <item><p><code>managed_agents</code> is optional.</p></item>
      <dt><code>{max_msg_size, integer()}</code></dt>
        <item><p>Optional. Default is <code>484</code>.</p></item>
      <dt><code>{mgr_port, integer()}</code></dt>
        <item><p>Optional. Default is <code>5000</code>.</p></item>
      <dt><code>{engine _id, string()}</code></dt>
        <item><p>Optional. Default is <code>"mgrEngine"</code>.</p></item>
    </taglist>

    <p>Agent configuration:</p>

    <taglist>
      <dt><code>{start_agent, boolean()}</code></dt>
        <item><p>Optional. Default is <code>false</code>.</p></item>
      <dt><code>{agent_sysname, string()}</code></dt>
        <item><p>Optional. Default is <code>"ct_test"</code>.</p></item>
      <dt><code>{agent_manager_ip, manager_ip()}</code></dt>
        <item><p>Optional. Default is <code>localhost</code>.</p></item>
      <dt><code>{agent_vsns, list()}</code></dt>
        <item><p>Optional. Default is <code>[v2]</code>.</p></item>
      <dt><code>{agent_trap_udp, integer()}</code></dt>
        <item><p>Optional. Default is <code>5000</code>.</p></item>
      <dt><code>{agent_udp, integer()}</code></dt>
        <item><p>Optional. Default is <code>4000</code>.</p></item>
      <dt><code>{agent_notify_type, atom()}</code></dt>
        <item><p>Optional. Default is <code>trap</code>.</p></item>
      <dt><code>{agent_sec_type, sec_type()}</code></dt>
        <item><p>Optional. Default is <code>none</code>.</p></item>
      <dt><code>{agent_passwd, string()}</code></dt>
        <item><p>Optional. Default is <code>""</code>.</p></item>
      <dt><code>{agent_engine_id, string()}</code></dt>
        <item><p>Optional. Default is <code>"agentEngine"</code>.</p></item>
      <dt><code>{agent_max_msg_size, string()}</code></dt>
        <item><p>Optional. Default is <code>484</code>.</p></item>
    </taglist>

    <p>The following parameters represents the SNMP configuration files
      <code>context.conf</code>, <code>standard.conf</code>, <code>community.conf</code>,
      <code>vacm.conf</code>, <code>usm.conf</code>, <code>notify.conf</code>,
      <code>target_addr.conf</code>, and <code>target_params.conf</code>. Notice that
      all values in <code>agent.conf</code> can be modified by the parameters
      listed above. All these configuration files have default values set by
      the <code>SNMP</code> application. These values can be overridden by suppling
      a list of valid configuration values or a file located in the test
      suites data directory, which can produce a list of valid configuration
      values if you apply function <code>file:consult/1</code> to the file.</p>

    <taglist>
      <dt><code>{agent_contexts, [term()] | {data_dir_file, rel_path()}}</code></dt>
        <item><p>Optional.</p></item>
      <dt><code>{agent_community, [term()] | {data_dir_file, rel_path()}}</code></dt>
        <item><p>Optional.</p></item>
      <dt><code>{agent_sysinfo,  [term()] | {data_dir_file, rel_path()}}</code></dt>
        <item><p>Optional.</p></item>
      <dt><code>{agent_vacm, [term()] | {data_dir_file, rel_path()}}</code></dt>
        <item><p>Optional.</p></item>
      <dt><code>{agent_usm, [term()] | {data_dir_file, rel_path()}}</code></dt>
        <item><p>Optional.</p></item>
      <dt><code>{agent_notify_def, [term()] | {data_dir_file, rel_path()}}</code></dt>
        <item><p>Optional.</p></item>
      <dt><code>{agent_target_address_def, [term()] | {data_dir_file, rel_path()}}</code></dt>
        <item><p>Optional.</p></item>
      <dt><code>{agent_target_param_def, [term()] | {data_dir_file, rel_path()}}</code></dt>
        <item><p>Optional.</p></item>
      </taglist>

    <p>Parameter <code>MgrAgentConfName</code> in the functions is to be a name
      you allocate in your test suite using a <code>require</code> statement.
      Example (where <code>MgrAgentConfName = snmp_mgr_agent</code>):</p>

    <pre class="sh_erlang">
 suite() -&gt; [{require, snmp_mgr_agent, snmp}].</pre>

    <p>or</p>

    <pre class="sh_erlang">
 ct:require(snmp_mgr_agent, snmp).</pre>

    <p>Notice that USM users are needed for SNMPv3 configuration and are
      not to be confused with users.</p>

    <p>SNMP traps, inform, and report messages are handled by the user
      callback module. For details, see the
      <a href="../snmp/index.html" class="seealso"><code>SNMP</code></a> application.</p>

    <p>It is recommended to use the <code>.hrl</code> files created by the
      Erlang/OTP MIB compiler to define the Object Identifiers (OIDs).
      For example, to get the Erlang node name from <code>erlNodeTable</code>
      in the OTP-MIB:</p>

    <pre class="sh_erlang">
 Oid = ?erlNodeEntry ++ [?erlNodeName, 1]</pre>

    <p>Furthermore, values can be set for <code>SNMP</code> application configuration
      parameters, <code>config</code>, <code>server</code>, <code>net_if</code>, and so on (for
      a list of valid parameters and types, see the  <a href="../snmp/users_guide.html" class="seealso"><code>User's Guide for the SNMP application</code></a>). This is
      done by defining a configuration data variable on the following form:</p>

    <pre class="sh_erlang">
 {snmp_app, [{manager, [snmp_app_manager_params()]},
             {agent, [snmp_app_agent_params()]}]}.</pre>

    <p>A name for the data must be allocated in the suite using
      <code>require</code> (see the example above). Pass this name as argument
      <code>SnmpAppConfName</code> to
      <a href="#start/3" class="seealso"><code>ct_snmp:start/3</code></a>.
      <code>ct_snmp</code> specifies default values for some <code>SNMP</code> application
      configuration parameters (such as <code>{verbosity,trace}</code> for parameter
      <code>config</code>). This set of defaults is merged with the parameters
      specified by the user. The user values override <code>ct_snmp</code>
      defaults.</p>

  </div>

  <div class="section">
    <h4>Data Types</h4>
    <span id="types"> </span>
    <taglist>
      <dt><code>agent_config() = {Item, Value}</code></dt>
      <item><span id="type-agent_config"> </span> </item>
      <dt><code>agent_ip() = ip()</code></dt>
      <item><span id="type-agent_ip"> </span> </item>
      <dt><code>agent_name() = atom()</code></dt>
      <item><span id="type-agent_name"> </span> </item>
      <dt><code>agent_port() = integer()</code></dt>
      <item><span id="type-agent_port"> </span> </item>
      <dt><code>call_back_module() = atom()</code></dt>
      <item><span id="type-call_back_module"> </span> </item>
      <dt><code>error_index() = integer()</code></dt>
      <item><span id="type-error_index"> </span> </item>
      <dt><code>error_status() = noError | atom()</code></dt>
      <item><span id="type-error_status"> </span> </item>
      <dt><code>ip() = string() | {integer(), integer(), integer(), integer()}</code></dt>
      <item><span id="type-ip"> </span> </item>
      <dt><code>manager_ip() = ip()</code></dt>
      <item><span id="type-manager_ip"> </span> </item>
      <dt><code>oid() = [byte()]</code></dt>
      <item><span id="type-oid"> </span> </item>
      <dt><code>oids() = [oid()]</code></dt>
      <item><span id="type-oids"> </span> </item>
      <dt><code>rel_path() = string()</code></dt>
      <item><span id="type-rel_path"> </span> </item>
      <dt><code>sec_type() = none | minimum | semi</code></dt>
      <item><span id="type-sec_type"> </span> </item>
      <dt><code>snmp_app_agent_params() = term()</code></dt>
      <item><span id="type-snmp_app_agent_params"> </span> </item>
      <dt><code>snmp_app_manager_params() = term()</code></dt>
      <item><span id="type-snmp_app_manager_params"> </span> </item>
      <dt><code>snmpreply() = {error_status(), error_index(), varbinds()}</code></dt>
      <item><span id="type-snmpreply"> </span> </item>
      <dt><code>user_data() = term()</code></dt>
      <item><span id="type-user_data"> </span> </item>
      <dt><code>user_name() = atom()</code></dt>
      <item><span id="type-user_name"> </span> </item>
      <dt><code>usm_config() = {Item, Value}</code></dt>
      <item><span id="type-usm_config"> </span> </item>
      <dt><code>usm_user_name() = string()</code></dt>
      <item><span id="type-usm_user_name"> </span> </item>
      <dt><code>value_type() = o('OBJECT IDENTIFIER') | i('INTEGER') | u('Unsigned32') | g('Unsigned32') | s('OCTET STRING')</code></dt>
      <item><span id="type-value_type"> </span> </item>
      <dt><code>var_and_val() = {oid(), value_type(), value()}</code></dt>
      <item><span id="type-var_and_val"> </span> </item>
      <dt><code>varbind() = term()</code></dt>
      <item><span id="type-varbind"> </span> </item>
      <dt><code>varbinds() = [varbind()]</code></dt>
      <item><span id="type-varbinds"> </span> </item>
      <dt><code>varsandvals() = [var_and_val()]</code></dt>
      <item><span id="type-varsandvals"> </span> </item>
    </taglist>
    <p>These data types are described in the documentation for
      the <a href="../snmp/index.html" class="seealso"><code>SNMP</code></a> application.</p>
  </div>

  <div id="functions" class="category"><h4><a href="#functions">Functions</a></h4><hr/>
    <div class="function">
      <h3 id="get_next_values/3">get_next_values(Agent, Oids, MgrAgentConfName) -&gt; SnmpReply</h3>
      
      <ul class="type">
        <li><code>Agent = agent_name()</code></li>
        <li><code>Oids = oids()</code></li>
        <li><code>MgrAgentConfName = atom()</code></li>
        <li><code>SnmpReply = snmpreply()</code></li>
      </ul>
      <div class="description">
        <p>Issues a synchronous SNMP <code>get next</code> request.</p>
      </div>
    </div>

    <div class="function">
      <h3 id="get_values/3">get_values(Agent, Oids, MgrAgentConfName) -&gt; SnmpReply</h3>
      
      <ul class="type">
        <li><code>Agent = agent_name()</code></li>
        <li><code>Oids = oids()</code></li>
        <li><code>MgrAgentConfName = atom()</code></li>
        <li><code>SnmpReply = snmpreply()</code></li>
      </ul>
      <div class="description">
        <p>Issues a synchronous SNMP <code>get</code> request.</p>
      </div>
    </div>

    <div class="function">
      <h3 id="load_mibs/1">load_mibs(Mibs) -&gt; ok | {error, Reason}</h3>
      
      <ul class="type">
        <li><code>Mibs = [MibName]</code></li>
        <li><code>MibName = string()</code></li>
        <li><code>Reason = term()</code></li>
      </ul>
      <div class="description">
        <p>Loads the MIBs into agent <code>snmp_master_agent</code>.</p>
      </div>
    </div>

    <div class="function">
      <h3 id="register_agents/2">register_agents(MgrAgentConfName, ManagedAgents) -&gt; ok | {error, Reason}</h3>
      
      <ul class="type">
        <li><code>MgrAgentConfName = atom()</code></li>
        <li><code>ManagedAgents = [agent()]</code></li>
        <li><code>Reason = term()</code></li>
      </ul>
      <div class="description">
        <p>Explicitly instructs the manager to handle this agent. Corresponds
          to making an entry in <code>agents.conf</code>.</p>

        <p>This function tries to register the specified managed agents, without
          checking if any of them exist. To change a registered managed agent,
          the agent must first be unregistered.</p>
      </div>
    </div>

    <div class="function">
      <h3 id="register_users/2">register_users(MgrAgentConfName, Users) -&gt; ok | {error, Reason}</h3>
      
      <ul class="type">
        <li><code>MgrAgentConfName = atom()</code></li>
        <li><code>Users = [user()]</code></li>
        <li><code>Reason = term()</code></li>
      </ul>
      <div class="description">
        <p>Registers the manager entity (=user) responsible for specific
          agent(s). Corresponds to making an entry in <code>users.conf</code>.</p>

        <p>This function tries to register the specified users, without checking
          if any of them exist. To change a registered user, the user must
          first be unregistered.</p>
      </div>
    </div>

    <div class="function">
      <h3 id="register_usm_users/2">register_usm_users(MgrAgentConfName, UsmUsers) -&gt; ok | {error, Reason}</h3>
      
      <ul class="type">
        <li><code>MgrAgentConfName = atom()</code></li>
        <li><code>UsmUsers = [usm_user()]</code></li>
        <li><code>Reason = term()</code></li>
      </ul>
      <div class="description">
        <p>Explicitly instructs the manager to handle this USM user.
          Corresponds to making an entry in <code>usm.conf</code>.</p>

        <p>This function tries to register the specified users, without checking
          if any of them exist. To change a registered user, the user must
          first be unregistered.</p>
      </div>
    </div>

    <div class="function">
      <h3 id="set_info/1">set_info(Config) -&gt; [{Agent, OldVarsAndVals, NewVarsAndVals}]</h3>
      
      <ul class="type">
        <li><code>Config = [{Key, Value}]</code></li>
        <li><code>Agent = agent_name()</code></li>
        <li><code>OldVarsAndVals = varsandvals()</code></li>
        <li><code>NewVarsAndVals = varsandvals()</code></li>
      </ul>
      <div class="description">
        <p>Returns a list of all successful <code>set</code> requests performed in
          the test case in reverse order. The list contains the involved user
          and agent, the value before <code>set</code>, and the new value. This is
          intended to simplify the cleanup in function <code>end_per_testcase</code>,
          that is, the undoing of the <code>set</code> requests and their possible
          side-effects.</p>
      </div>
    </div>

    <div class="function">
      <h3 id="set_values/4">set_values(Agent, VarsAndVals, MgrAgentConfName, Config) -&gt; SnmpReply</h3>
      
      <ul class="type">
        <li><code>Agent = agent_name()</code></li>
        <li><code>Oids = oids()</code></li>
        <li><code>MgrAgentConfName = atom()</code></li>
        <li><code>Config = [{Key, Value}]</code></li>
        <li><code>SnmpReply = snmpreply()</code></li>
      </ul>
      <div class="description">
        <p>Issues a synchronous SNMP <code>set</code> request.</p>
      </div>
    </div>

    <div class="function">
      <h3 id="start/2">start(Config, MgrAgentConfName) -&gt; ok</h3>
      
      <div class="description">
        <p>Equivalent to
          <a href="#start/3" class="seealso"><code>ct_snmp:start(Config, MgrAgentConfName,
          undefined)</code></a>.</p>
      </div>
    </div>

    <div class="function">
      <h3 id="start/3">start(Config, MgrAgentConfName, SnmpAppConfName) -&gt; ok</h3>
      
      <ul class="type">
        <li><code>Config = [{Key, Value}]</code></li>
        <li><code>Key = atom()</code></li>
        <li><code>Value = term()</code></li>
        <li><code>MgrAgentConfName = atom()</code></li>
        <li><code>SnmpConfName = atom()</code></li>
      </ul>
      <div class="description">
        <p>Starts an SNMP manager and/or agent. In the manager case,
          registrations of users and agents, as specified by the configuration
          <code>MgrAgentConfName</code>, are performed. When using SNMPv3, called
          USM users are also registered. Users, <code>usm_users</code>, and
          managed agents can also be registered later using
          <a href="#register_users/2" class="seealso"><code>ct_snmp:register_users/2</code></a>,
          <a href="#register_agents/2" class="seealso"><code>ct_snmp:register_agents/2</code></a>,
          and
          <a href="#register_usm_users/2" class="seealso"><code>ct_snmp:register_usm_users/2</code></a>.</p>

        <p>The agent started is called <code>snmp_master_agent</code>. Use
          <a href="#load_mibs/1" class="seealso"><code>ct_snmp:load_mibs/1</code></a>
          to load MIBs into the agent.</p>

        <p>With <code>SnmpAppConfName</code> SNMP applications can be configured
          with parameters <code>config</code>, <code>mibs</code>, <code>net_if</code>, and so on.
          The values are merged with (and possibly override) default values
          set by <code>ct_snmp</code>.</p>
      </div>
    </div>

    <div class="function">
      <h3 id="stop/1">stop(Config) -&gt; ok</h3>
      
      <ul class="type">
        <li><code>Config = [{Key, Value}]</code></li>
        <li><code>Key = atom()</code></li>
        <li><code>Value = term()</code></li>
      </ul>
      <div class="description">
        <p>Stops the SNMP manager and/or agent, and removes all files
          created.</p>
      </div>
    </div>

    <div class="function">
      <h3 id="unload_mibs/1">unload_mibs(Mibs) -&gt; ok | {error, Reason}</h3>
      
      <ul class="type">
        <li><code>Mibs = [MibName]</code></li>
        <li><code>MibName = string()</code></li>
        <li><code>Reason = term()</code></li>
      </ul>
      <div class="description">
        <p>Unloads the MIBs from agent <code>snmp_master_agent</code>.</p>
      </div>
    </div>

    <div class="function">
      <h3 id="unregister_agents/1">unregister_agents(MgrAgentConfName) -&gt; ok</h3>
      
      <ul class="type">
        <li><code>MgrAgentConfName = atom()</code></li>
        <li><code>Reason = term()</code></li>
      </ul>
      <div class="description">
        <p>Unregisters all managed agents.</p>
      </div>
    </div>

    <div class="function">
      <h3 id="unregister_agents/2">unregister_agents(MgrAgentConfName, ManagedAgents) -&gt; ok</h3>
      
      <ul class="type">
        <li><code>MgrAgentConfName = atom()</code></li>
        <li><code>ManagedAgents = [agent_name()]</code></li>
        <li><code>Reason = term()</code></li>
      </ul>
      <div class="description">
        <p>Unregisters the specified managed agents.</p>
      </div>
    </div>

    <div class="function">
      <h3 id="unregister_users/1">unregister_users(MgrAgentConfName) -&gt; ok</h3>
      
      <ul class="type">
        <li><code>MgrAgentConfName = atom()</code></li>
        <li><code>Reason = term()</code></li>
     </ul>
     <div class="description">
       <p>Unregisters all users.</p>
     </div>
    </div>

    <div class="function">
      <h3 id="unregister_users/2">unregister_users(MgrAgentConfName, Users) -&gt; ok</h3>
      
      <ul class="type">
        <li><code>MgrAgentConfName = atom()</code></li>
        <li><code>Users = [user_name()]</code></li>
        <li><code>Reason = term()</code></li>
      </ul>
      <div class="description">
        <p>Unregisters the specified users.</p>
      </div>
    </div>

    <div class="function">
      <h3 id="unregister_usm_users/1">unregister_usm_users(MgrAgentConfName) -&gt; ok</h3>
      
      <ul class="type">
        <li><code>MgrAgentConfName = atom()</code></li>
        <li><code>Reason = term()</code></li>
      </ul>
      <div class="description">
        <p>Unregisters all USM users.</p>
      </div>
    </div>

    <div class="function">
      <h3 id="unregister_usm_users/2">unregister_usm_users(MgrAgentConfName, UsmUsers) -&gt; ok</h3>
        
      <ul class="type">
        <li><code>MgrAgentConfName = atom()</code></li>
        <li><code>UsmUsers = [usm_user_name()]</code></li>
        <li><code>Reason = term()</code></li>
      </ul>
      <div class="description">
        <p>Unregisters the specified USM users.</p>
      </div>
    </div>
  </div>


      </div>
  </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="../jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="../erldocs.js"></script>
  </body>
</html>
