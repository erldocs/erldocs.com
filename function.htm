<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>erldocs.com - Function lookup</title>
    <script type="text/javascript" src="jquery-1.10.2.min.js"></script>
    <link type="text/css" href="typeahead-examples.css" rel="stylesheet"/>
    <link type="text/css" href="repo.css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs_other"/>

    <script>
      var _gaq = _gaq || [];
      _gaq.push(['_require', 'inpage_linkid', '//www.google-analytics.com/plugins/ga/inpage_linkid.js']);
      _gaq.push(['_setAccount', 'UA-44246018-1']);
      _gaq.push(['_setDomainName', 'erldocs.com']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

      $(document).ready(function () {
        INDEXES = {"count": 0};
        BAR = $("input .typeahead");
        MSG = $("#msg");
        RELEASES = erldocs_api["otp_releases_built"];
        COUNT = 4; //RELEASES.length;

      var cacheScript = function (Url, Success) {
        $.ajaxSetup({"cache": true});
        return $.getScript(Url).done(Success);
      };

      var cacheReleaseIndex = function (Release) {
        cacheScript("http://erldocs.com/"+Release+"/erldocs_index.js", function (src, status) {
          console.log("Loading index from "+ Release +": "+ status);
          INDEXES[Release] = $.map(index, function (e, i) {
            if (e[0] !== "fun")
              return;
            return {'value': e.slice(2,3)[0]};
          });
          INDEXES["count"] += 1;
          index = [];
          MSG.html(INDEXES["count"] +" / "+ COUNT);
        });
      };

      <!-- for (var i = 0; i < COUNT; i++) -->
      <!--   cacheReleaseIndex(RELEASES[i]); -->
      cacheReleaseIndex("R15B03");
      cacheReleaseIndex("R15B02");
      cacheReleaseIndex("R15B01");
      cacheReleaseIndex("R15B");

      var r15b = new Bloodhound({
      datumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),
      queryTokenizer: Bloodhound.tokenizers.whitespace,
      local: INDEXES["R15B"]
      });
      var r15b03 = new Bloodhound({
      datumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),
      queryTokenizer: Bloodhound.tokenizers.whitespace,
      local: INDEXES["R15B03"]
      });
      r15b.initialize();
      r15b03.initialize();

      BAR.typeahead({
        hint: true,
        highlight: true,
        minLength: 3 }, {
        name: "R15B",
        displayKey: 'value',
        source: r15b.ttAdapter(),
        templates: {header: '<h3 class="otp-release">R15B</h3>'}}, {
        name: "R15B03",
        displayKey: 'value',
        source: r15b03.ttAdapter(),
        templates: {header: '<h3 class="otp-release">R15B03</h3>'}
      });

      });
    </script>
  </head>
  <body>
    <div id="front_page">
      <h1>function lookup</h1>
      Find the OTP releases providing this function<br/><br/>
      <span id="msg" style="color:#666;">loading indexesâ€¦</span>
      <br/>
      <input type="text" class="typeahead" name="q" placeholder="function name" size="50" autofocus/>
      <br/>
      <p><a href="//erldocs.com">home</a></p>
    </div>

    <script type="text/javascript" src="handlebars.runtime.min-v1.2.0.js"></script>
    <script type="text/javascript" src="typeahead.bundle.min.js"></script>
    <script type="text/javascript" src="api/v1.js"></script>
  </body>
</html>

