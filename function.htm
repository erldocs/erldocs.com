<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>erldocs.com - Function lookup</title>
    <script type="text/javascript" src="jquery-1.10.2.min.js"></script>
    <link type="text/css" href="typeahead-examples.css" rel="stylesheet"/>
    <link type="text/css" href="repo.css" rel="stylesheet"/>
    <link href="/search.xml" rel="search" type="application/opensearchdescription+xml" title="erldocs_other"/>

    <script>
      var _gaq = _gaq || [];
      _gaq.push(['_require', 'inpage_linkid', '//www.google-analytics.com/plugins/ga/inpage_linkid.js']);
      _gaq.push(['_setAccount', 'UA-44246018-1']);
      _gaq.push(['_setDomainName', 'erldocs.com']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

      $.fn.enterKey = function (fnc, mod) {
        return this.each(function () {
          $(this).keypress(function (ev) {
            var keycode = (ev.keyCode ? ev.keyCode : ev.which);
            if ((keycode == '13' || keycode == '10') && (!mod || ev[mod + 'Key']))
              fnc.call(this, ev);
          });
        });
      };

      $(document).ready(function () {
        INDEX = [];
        COUNT = 0;
        RELEASES = erldocs_api["otp_releases_built"];
        RELEASES_COUNT = RELEASES.length;
        $.ajaxSetup({"cache": true});

        var update = function () {
          $("#msg").html("Searching "+ COUNT +" / "+ RELEASES_COUNT +" releases");
          if (COUNT === RELEASES_COUNT)
            setup();
        };

        var cacheReleaseIndex = function (Release) {
          if (Release === undefined) return;
          $.getScript("http://erldocs.com/"+Release+"/erldocs_index.js").done(function (src, status) {
            var pos = $.inArray(Release, RELEASES);
            $.each(index, function (i, o) {
              if (o[0] !== "fun")  return;
              INDEX.push({"mfa": o[2], "otp": pos});
            });
            COUNT += 1;
            index = null;
            update();
          });
        };

      for (var i = 0; i < RELEASES_COUNT; i++)
        cacheReleaseIndex(RELEASES[i]);

        function setup () {
          var getData = function () {
            DATA = new Bloodhound({
              datumTokenizer: Bloodhound.tokenizers.obj.whitespace("mfa")
            , queryTokenizer: Bloodhound.tokenizers.whitespace
            , local: INDEX
            , limit: RELEASES_COUNT
            });
            DATA.initialize();
            return DATA.ttAdapter();
          };

          var ppSuggestion = function (o) {
            return "<p>"+ o["mfa"] +" ~ <strong>"+ RELEASES[o["otp"]] +"</strong></p>";
          };
          var ppEmpty = '<p style="text-align:center;">No Erlang/OTP release provides this function</p>'
          $("#bar").typeahead({ hint: true
                              , highlight: true
                              , minLength: 3 }, { name: "funs"
                                                , displayKey: "mfa"
                                                , source: getData()
                                                , templates: { suggestion: ppSuggestion
                                                             , empty: ppEmpty }
                                                })
                   .focus()
                   .enterKey(function () {
                     $(".tt-dropdown-menu").show();
          });
        };

      });
    </script>
    <style type="text/css">
      <!-- #scrollable-dropdown-menu .tt-dropdown-menu { max-height:150px; overflow-y:auto; } -->
    </style>
  </head>
  <body>
    <div id="front_page">
      <h1>function lookup</h1>
      Find the OTP releases providing this function<br/><br/>
      <span id="msg" style="color:#666;">loading indexesâ€¦</span>
      <br/>
      <div id="scrollable-dropdown-menu">
        <input type="text" id="bar" class="typeahead" name="q" placeholder="Module:Function/Arity" size="50" autofocus/>
      </div>
      <br/>
      <p><a href="//erldocs.com">home</a></p>
    </div>

    <script type="text/javascript" src="typeahead.bundle-0.10.5.js"></script>
    <script type="text/javascript" src="api/v1.js"></script>
  </body>
</html>

